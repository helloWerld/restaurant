import { isUsingFirebaseJsSdk } from "./utils.js";
const dirname = process.env.__FIREBASE_FRAMEWORKS_ENTRY__;
const usingFirebaseJsSdk = await isUsingFirebaseJsSdk();
const basename = usingFirebaseJsSdk ? "firebase-aware" : "index";
// .env isn't parsed for Cloud Functions discovery during deploy, handle undefined
const { handle: frameworkHandle } = dirname
    ? (await import(`./${dirname}/${basename}.js`))
    : { handle: undefined };
// TODO move to middleware
const firebaseAware = usingFirebaseJsSdk ? await import("./firebase-aware.js") : undefined;
export const handle = frameworkHandle
    ? firebaseAware?.handleFactory(frameworkHandle) || frameworkHandle
    : (req, res) => {
        // TODO log some sort of error here
        res.end();
    };
